[{"name":"app.R","content":"# Task Name: Bezugsnorm_erkennen ######################\n\nlibrary(shiny)\nlibrary(bslib)\nlibrary(shinyjs)\nlibrary(dplyr)\nlibrary(learnr)\nlibrary(shinycssloaders)\n\n\n## UI #########################################################################\nui <- page_fixed(\n  useShinyjs(),\n  card(\n      card_header(\n          \"Aufgabe: Bezugsnorm in Aussage erkennen\",\n          class = \"bg-dark\"),\n      card_body(\n      htmlOutput(\"prompt_task\")\n      )\n    ),\n  shinyjs::hidden(card(id = \"feedbackpanel_task\",\n      card_header(\n          \"Feedback\",\n          class = \"bg-dark\"),\n      card_body(\n          withSpinner(\n                                htmlOutput(\"feedback_task\"),\n                                proxy.height = \"50px\",\n                                color = \"#8cd000\"))\n          )\n      ),\n    card(\n      uiOutput(\"ui_answers_task\"),\n      layout_column_wrap(\n        width = \"200px\",\n        actionButton(\"show_feedback_task\", \n                     \"Prüfe meine Lösung!\",\n                     icon = icon(\"microscope\")),\n        actionButton(\"reshuffle_task\", \n                     \"Diese Aufgabe wiederholen\",\n                     icon = icon(\"repeat\")),\n        actionButton(\"new_task\", \n                     \"Neue Aufgabe derselben Art\",\n                     icon = icon(\"circle-plus\"))\n        )      \n    )\n)\n\n\n\nserver <- function(input, output, session) {\n\n  ##############################################################################\n  # Backend for task  ##########################################################\n  ##############################################################################\n\n  \n  ## Parameter solution matrix for task  ####\n  q_a_matrix_qshuffeled <- \n    tibble(\n      Answers_and_Distractors = c(\"Kriteriale Bezugsnorm\", \"Soziale Bezugsnorm\", \"Individuelle Bezugsnorm\"),\n      \n      `Bei Schüler:in X hat sich die Leistung von Woche 6 zu 8 verschlechtert.` = c(F,F,T),\n      `Im Test zeigt sich, dass Schüler:in X eine Verbesserung durchlebte, vor allem von Woche 4 zu Woche 6.` = c(F,F,T),\n      `Schüler:in X hat sich verschlechtert.` = c(F,F,T),\n      `Manche Schüler:innen verschlechtern sich und manche Schüler:innen verbessern sich deutlich.` = c(F,F,T),\n      `Einige Schüler:innen verbessern sich.` = c(F,F,T),\n      `Zentrale Ergebnisse hier sind, dass Schüler:in X von Stufe 5 auf Stufe 1 gerutscht ist.` = c(F,F,T),\n      \n      `Schüler:in X liegt innerhalb der mittleren 90% der Vergleichsgruppe.` = c(F,T,F),\n      `Die Klasse schneidet sogar besser als Vergleichsgruppe ab.` = c(F,T,F),\n      `Diese Klasse scheint besser abgeschnitten zu haben als die Vergleichsgruppe, beziehend auf die mittleren 50%.` = c(F,T,F),\n      `Einige Schüler:innen sind besser als der Landesdurchschnitt.` = c(F,T,F),\n      `Es gibt einige Schüler:innen, die sind (viel) schlechter als die anderen.` = c(F,T,F),\n      `Es gibt nur wenige Ausreißer von den anderen weg nach unten hin, aber einige davon gravierend.` = c(F,T,F),\n      `Die meisten der Kinder liegen weit über dem Durchschnitt` = c(F,T,F),\n      \n      `Die große Mehrheit der Schüler:innen befinden sich weit über dem Grundanspruch/Mindeststandard für eine Klasse 9.` = c(T,F,F),\n      `Die meisten Schüler erfüllen den Anspruch oder sind sogar darüber.` = c(T,F,F),\n      `Y kann den text Y in einer Minute fehlerfrei abschreiben` = c(T,F,F),\n      `Schüler:in X kann chemische Reaktionen von Aggregatszustandsänderungen unterscheiden.` = c(T,F,F),\n      `Schüler:in X kann den Strahlensatz sicher auf Alltagsprobleme anwenden` = c(T,F,F)\n      ) %>% \n    # shuffle order of questions\n    relocate(1, 2, sample(3:ncol(.), ncol(.) - 2))\n  \n  ## Number of \n  \n  ## Shuffle answers\n  q_a_matrix_qashuffeled <- \n    reactive({\n      input$reshuffle_task # answer shuffelling induced by both buttons\n      input$new_task\n      \n      q_a_matrix_qshuffeled %>%\n        sample_frac(., size = 1)\n    })\n  \n  ## Select task \n  nth_task <- reactive({\n    # starting with 1\n    (as.numeric(input$new_task) %% (ncol(q_a_matrix_qshuffeled) - 1)) + 1\n  })\n  \n  \n  ## Render UI for Answers ###\n  output$ui_answers_task <- renderUI({\n    input$reshuffle_task\n    input$new_task\n    radioButtons(\n      \"answers_task\",\n      \"Bitte ankreuzen\",\n      q_a_matrix_qashuffeled() %>% \n        select(1, nth_task() + 1) %>% \n        na.omit(.) %>% \n        pull(Answers_and_Distractors),\n      selected = character(0)\n    )\n  })\n  \n  ## Prompt task \n  output$prompt_task <- renderText({\n    paste(\"<b>Entlang welcher Bezugsnorm bewertet die folgende Aussage eine Leistung?<\/b><i>\",\n          names(q_a_matrix_qashuffeled())[2:ncol(q_a_matrix_qshuffeled)][nth_task()],\n          \"<\/i>\"\n          )\n  }) \n  \n  ## Correct answers ###\n  correct_answers_task <- reactive({\n    \n    vector_of_correct_answers <- \n      q_a_matrix_qashuffeled() %>% \n      pull(nth_task() + 1)\n    \n    correct_answers_task <- \n      q_a_matrix_qashuffeled() %>%\n      filter(vector_of_correct_answers == T) %>%\n      pull(Answers_and_Distractors)\n    \n    return(correct_answers_task)\n  })\n  \n  ## Feedback task  ####\n  output$feedback_task <- renderText({   \n    \n    if(is.null(input$answers_task)){\n      HTML(paste(\"<b>Leider nicht korrekt!<\/b> Richtig wäre:  <br>✓ \", \n                 paste(correct_answers_task(), collapse = \", <br>✓ \"),\n                 \"<br><i>\",\n                 learnr::random_encouragement(),\n                 \"<\/i>\"))\n    }else{\n      if(setequal(correct_answers_task(), input$answers_task)){\n        paste(\"Richtig!\", learnr::random_praise())}else{\n          HTML(paste(\"<b>Leider nicht korrekt!<\/b> Richtig wäre:  <br>✓ \", \n                     paste(correct_answers_task(), collapse = \", <br>✓ \"),\n                     \"<br><i>\",\n                     learnr::random_encouragement(),\n                     \"<\/i>\"))\n        }\n    }\n  })\n  \n  ## Show and Hide Feedback ####################################################\n  ## Show feedback on button click \n  observeEvent(input$show_feedback_task, {\n    showElement(id = \"feedbackpanel_task\")\n  })\n  \n  ## Hide feedback on solution change or new plot type\n  observeEvent(c(input$answers_task, input$new_task), {\n    hideElement(id = \"feedbackpanel_task\")\n  })\n  \n  ## Reset answer on new plot type\n  observeEvent(c(input$reshuffle_task, input$new_task), {\n    reset(id = \"answers_task\")\n  })\n  \n}\n\n\n# Create Shiny object\nshinyApp(ui = ui, server = server)\n","type":"text"}]
